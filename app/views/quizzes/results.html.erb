<h4> <%= @quiz.name %> </h4>

<% counter = 0 %>
<% scores_total = 0 %>


    <table>
    <th width="20px" align="left"></th>
    <th width="160px" align="left">Name</th>
    <th width="160px" align="left">Score</th>
    <th width="160px" align="left"># of Qs</th>
    <th width="160px" align="left">Class avg. on Qs</th>

  <% if @quiz.status == "active" %>
    <% @quiz.users.each_with_index do |student, i| %>
      <% if student.results.where(:quiz_id => @quiz.id).pop %>
        <% counter += 1 %>
        <% scores_total += student.results.where(:quiz_id => @quiz.id).pop.score %>
        <%# user = User.find(result.user_id) %>
        <tr>
          <td><%= i + 1 %>.</td>
          <td><%= student.name %></td>
          <td><%= number_to_percentage(student.results.where(:quiz_id => @quiz.id).pop.score, precision: 1) %></td>
          <td><%= @questions.where(:user_id => student.id).size %> </td>
          <td><%= student.class_average(@quiz)%> </td>
        </tr>
      <% end %>
    <% end %>

<% elsif @quiz.status == "completed" %>
  <% @quiz.users.each_with_index do |student, i| %>
      <% if student.results.where(:quiz_id => @quiz.id).pop %>
        <% counter += 1 %>
        <% scores_total += student.results.where(:quiz_id => @quiz.id).pop.score %>
        <%# user = User.find(result.user_id) %>
        <tr>
          <td><%= i + 1 %>.</td>
          <td><%= student.name %></td>
          <td><%= number_to_percentage(student.results.where(:quiz_id => @quiz.id).pop.score, precision: 1) %></td>
          <td><%= @questions.where(:user_id => student.id).size %> </td>
          <td><%= student.class_average(@quiz)%> </td>
        </tr>
      <% else %>
        <tr>
          <td><%= i + 1 %>.</td>
          <td><%= student.name %></td>
          <td> Did Not Submit </td>
          <td><%= @questions.where(:user_id => student.id).size %> </td>
          <td><%= student.class_average(@quiz)%> </td>
        </tr>
      <% end %>
    <% end %>

<% end %>
    </table>

<h5>Class Average (For submitted quizzes)</h5>
<% unless counter == 0 %>

  <%= number_to_percentage(scores_total / counter, precision: 1) %> <br>
<% end %>
</br>
<% if @quiz.status != "completed" %>
 <a href="<%= results_quiz_path(@quiz) %>" class="btn btn-large btn-primary">Update</a>
<a href="<%= set_status_quiz_path(@quiz, :status=> "completed") %>" class="btn btn-large btn-primary">End Quiz</a>
<% end %>
<br>
<br>
